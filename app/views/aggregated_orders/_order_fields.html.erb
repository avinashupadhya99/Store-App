<article class="card my-1">

	<div class="row mt-2"> <!--Error messages-->
		<div class="col-md-10 offset-md-1 col-sm-10 offset-sm-1 col-10 offset-10">
				<div class='alert alert-danger error-alert'>
					<a href="#" class="close" data-dismiss="alert">&#215;</a>
					<span class="error_message"></span>
				</div>
		</div>
	</div>
	<div class="row mx-2 my-1">
		<div class="col-sm-12 col-md-12 col-lg-12 col-xl-2">
			<div class="form-group">
				<h5 class="font-weight-normal">
					<%= f.label :product_id %>
				</h5>
					<%= f.number_field :product_id, class: "form-control", id: "product_id", placeholder: "Product ID" %>
			</div>
		</div>
		<div class="col-sm-12 col-md-12 col-lg-12 col-xl-5">
			<div class="form-group">
				<h5 class="font-weight-normal">
					<%= f.label :quantity %>
				</h5>
					<%= f.number_field :quantity, class: "form-control", id: "quantity", :readonly => true, placeholder: "Enter quantity" %>
			</div>
		</div>
		<div class="col-sm-12 col-md-12 col-lg-12 col-xl-5">
			<div class="form-group">
				<h5 class="font-weight-normal">
					<%= f.label :amount %>
				</h5>
					<%= f.number_field :amount, class: "form-control", :readonly => true, placeholder: "Amount" %>
			</div>
		</div>
		<div class="col-md-8 offset-md-2">
			<span class="float-right">
				<%= f.hidden_field :_destroy %>
    			<%= link_to 'Delete', '#', class: 'remove_record btn btn-danger btn-sm' %>
			</span>
		</div>
	</div>
</article>
<script>
    $('.error-alert').hide(); //Initially hide the error alert
	<% products = Product.all %> //Fetch all products from db
	var prods = '<%= products.to_json %>'; //Convert to json with ruby
	var jsprods = prods.replace(/&quot;/g, "\""); //Replace all &quot; with "
	var jsonprods = JSON.parse(jsprods); //Parse the converted string into JSON format
	$('article #product_id').on('keydown blur', function(event) {
		if(event.keyCode == 13 || event.keyCode == 9 || event.type=='blur'){ //Check if enter or tab is pressed
			var p = $(this).val(); //Product id entered 
			var $q =$(this).closest('article').find("#quantity"); //Quantity input field of the current form
			//Add validation here
			var found = false; //Flag to check if product exists
			$.each( jsonprods, function( key, value ) { //Loop through the JSON
				if(value.id == p){ //Check if product id exists
					$q.attr("readonly", false); //set quantity field as editable
					found = true;
				}
			});
			if(found==false) {
				$(this).closest('article').find('.error-alert').show();
				$q.val('');
				$q.attr("readonly", true);
				$(this).closest('article').find('.error_message').html('No product with that ID');
			} else {
				$(this).closest('article').find('.error-alert').hide();

			}
			if(event.keyCode == 13) {
				event.preventDefault();
			}
		}
	});
</script>